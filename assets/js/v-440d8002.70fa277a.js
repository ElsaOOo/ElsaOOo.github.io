(self.webpackChunkmy_blog_next=self.webpackChunkmy_blog_next||[]).push([[144],{6864:(n,a,s)=>{"use strict";s.r(a),s.d(a,{data:()=>t});const t={key:"v-440d8002",path:"/posts/custom-loader.html",title:"Webpack custom loader",lang:"zh-CN",frontmatter:{lang:"zh-CN",description:"webpack webpack 自定义loader"},excerpt:"",headers:[],filePathRelative:"posts/custom-loader.md",git:{contributors:[]}}},8448:(n,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>p});const t=(0,s(6252).uE)('<h1 id="webpack-custom-loader"><a class="header-anchor" href="#webpack-custom-loader">#</a> Webpack custom loader</h1><p><em><em>文章引用请注明出处</em></em></p><p>本文讲一下怎么制作自己的webpack 自定义loader。</p><p>webpack loader的作用是进行模块资源的转换，webpack打包只认识js，这个时候项目里使用到的图片资源、样式资源等就需要用loader来进行转换，转换成js，然后webpack再进行打包。</p><p>那loader是怎样进行转换的呢，每种loader就是一个js文件，它接收到webpack传给它的“上下文”， 这个“上下文”就是项目源代码，loader拿到源代码，其实是一系列字符串，就可以进行操作转换了。</p><p>下面看一个demo：</p><p>比如我们有这样一个需求，就是在我们所有的打包文件中都加上 “ 公司名@年份” 这个注释句子。</p><p>首先我们可以在webpack.config.js的同级目录下创建一个目录叫做<code>custom-loaders</code> ，然后在这个目录下创建一个自定义loader文件<code>add-copyright-loader.js</code></p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// `add-copyright-loader.js`</span>\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/** alibaba@2020 */\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre></div><p>loader文件是一个node模块， 以commonJs的方式导出一个函数，这个函数接收的参数有三个，content, map, meta，map和meta是可以省略的，其中content能拿到webpack处理源文件时每个文件对应的代码，它是string或者buffer（buffer可以转换成string），我们拿到这个字符串就能对源代码进行修改了，转换成我们需要的样子再返回回去。</p><p>在webpack.config.js中把我们的自定义loader加进来：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// ... </span>\nmodule<span class="token operator">:</span> <span class="token punctuation">{</span>\n    rules<span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(j|t)sx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>\n        use<span class="token operator">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>\n              __dirname<span class="token punctuation">,</span>\n              <span class="token string">&quot;./custom-loaders/add-copyright-loader.js&quot;</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div><p>然后执行<code>npm run build</code>，我们就可以在打包文件中看到：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// dist/index.js 这个是webpack config mode 设置为&#39;none&#39;时打包的结果</span>\n<span class="token doc-comment comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>\n<span class="token comment">/* 0 */</span>\n<span class="token doc-comment comment">/***/ (function(module, __webpack_exports__, __webpack_require__) <span class="token punctuation">{</span>\n\n&quot;use strict&quot;;\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */</span> <span class="token keyword">var</span> _add__WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token doc-comment comment">/** alibaba@2020 */</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n<span class="token doc-comment comment">/***/ <span class="token punctuation">}</span>),\n/* 1 */</span>\n<span class="token doc-comment comment">/***/ (function(module, __webpack_exports__, __webpack_require__) <span class="token punctuation">{</span>\n\n&quot;use strict&quot;;\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> add<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token doc-comment comment">/** alibaba@2020 */</span>\n<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>\n\n\n<span class="token doc-comment comment">/***/ <span class="token punctuation">}</span>)\n/******/</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><p>总结：webpack loader 其实就是对资源文件的转换，从上一个laoder拿到结果，转换后再返回给下一个loader，所以在配置文件中要注意loader的顺序。</p>',15),p={render:function(n,a){return t}}}}]);