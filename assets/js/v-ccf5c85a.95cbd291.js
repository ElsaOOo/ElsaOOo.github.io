(self.webpackChunkmy_blog_next=self.webpackChunkmy_blog_next||[]).push([[918],{9228:(e,a,n)=>{"use strict";n.r(a),n.d(a,{data:()=>o});const o={key:"v-ccf5c85a",path:"/javascript/custom-loader.html",title:"Webpack custom loader",lang:"zh-CN",frontmatter:{lang:"zh-CN",description:"webpack webpack 自定义loader"},excerpt:"",headers:[]}},3971:(e,a,n)=>{"use strict";n.r(a),n.d(a,{default:()=>r});const o=(0,n(6252).uE)('<h1 id="webpack-custom-loader" tabindex="-1"><a class="header-anchor" href="#webpack-custom-loader" aria-hidden="true">#</a> Webpack custom loader</h1><p><em><em>文章引用请注明出处</em></em></p><p>本文讲一下怎么制作自己的webpack 自定义loader。</p><p>webpack loader的作用是进行模块资源的转换，webpack打包只认识js，这个时候项目里使用到的图片资源、样式资源等就需要用loader来进行转换，转换成js，然后webpack再进行打包。</p><p>那loader是怎样进行转换的呢，每种loader就是一个js文件，它接收到webpack传给它的“上下文”， 这个“上下文”就是项目源代码，loader拿到源代码，其实是一系列字符串，就可以进行操作转换了。</p><p>下面看一个demo：</p><p>比如我们有这样一个需求，就是在我们所有的打包文件中都加上 “ 公司名@年份” 这个注释句子。</p><p>首先我们可以在webpack.config.js的同级目录下创建一个目录叫做<code>custom-loaders</code> ，然后在这个目录下创建一个自定义loader文件<code>add-copyright-loader.js</code></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>// `add-copyright-loader.js`\nmodule.exports = function (content) {\n  return `/** alibaba@2020 */\\n${content}`;\n};\n</code></pre></div><p>loader文件是一个node模块， 以commonJs的方式导出一个函数，这个函数接收的参数有三个，content, map, meta，map和meta是可以省略的，其中content能拿到webpack处理源文件时每个文件对应的代码，它是string或者buffer（buffer可以转换成string），我们拿到这个字符串就能对源代码进行修改了，转换成我们需要的样子再返回回去。</p><p>在webpack.config.js中把我们的自定义loader加进来：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>// ... \nmodule: {\n    rules: [\n      {\n        test: /\\.(j|t)sx?$/,\n        use: [\n          {\n            loader: path.resolve(\n              __dirname,\n              &quot;./custom-loaders/add-copyright-loader.js&quot;\n            ),\n          },\n        ],\n        exclude: /node_modules/,\n      },\n    ],\n  },\n</code></pre></div><p>然后执行<code>npm run build</code>，我们就可以在打包文件中看到：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>// dist/index.js 这个是webpack config mode 设置为&#39;none&#39;时打包的结果\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n&quot;use strict&quot;;\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _add__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/** alibaba@2020 */\n\nconsole.log(&quot;test&quot;);\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n&quot;use strict&quot;;\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, &quot;add&quot;, function() { return add; });\n/** alibaba@2020 */\nconst add = (a, b) =&gt; a + b;\n\n\n/***/ })\n/******/ ]);\n</code></pre></div><p>总结：webpack loader 其实就是对资源文件的转换，从上一个laoder拿到结果，转换后再返回给下一个loader，所以在配置文件中要注意loader的顺序。</p>',15),r={render:function(e,a){return o}}}}]);